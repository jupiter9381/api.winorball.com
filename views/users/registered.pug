extends ../layouts/index

block content
    .container-fluid
        .row
            .col.s12
                .card
                    .card-content
                        h4.card-title User list
                        h6.card-subtitle
                        if users==null
                            h5 There is no data
                            //- a.waves-effect.waves-light.btn.modal-trigger(href='#add-contact') Add New Contact
                            //- #add-contact.modal
                            //-                         .modal-content
                            //-                             from
                            //-                                 .row
                            //-                                     .input-field.col.s12
                            //-                                         input#name(type='text')
                            //-                                         label(for='name') Name
                            //-                                 .row
                            //-                                     .input-field.col.s12
                            //-                                         input#email(type='email')
                            //-                                         label(for='email') Email
                            //-                                 .row
                            //-                                     .input-field.col.s12
                            //-                                         input#phone(type='text')
                            //-                                         label(for='phone') Phone
                            //-                                 .row
                            //-                                     .input-field.col.s12
                            //-                                         input#designation(type='text')
                            //-                                         label(for='designation') Designation
                            //-                                 .row
                            //-                                     .input-field.col.s12
                            //-                                         input#age(type='text')
                            //-                                         label(for='age') Age
                            //-                                 .row
                            //-                                     .input-field.col.s12
                            //-                                         input#date.datepicker(type='text')
                            //-                                         label(for='date') Date
                            //-                                 .row
                            //-                                     .input-field.col.s12
                            //-                                         input#salary(type='text')
                            //-                                         label(for='salary') Salary
                            //-                                 .row
                            //-                                     .file-field.input-field.col.s12
                            //-                                         .btn
                            //-                                             span File
                            //-                                             input(type='file')
                            //-                                         .file-path-wrapper
                            //-                                             input.file-path.validate(type='text')
                            //-                         .modal-footer
                            //-                             a.btn.modal-action.modal-close.waves-effect.waves-light.cyan(href='#!') Save
                            //-                             a.btn.modal-action.modal-close.waves-effect.waves-light.grey.darken-4(href='#!') Cancel
                        else
                            .table-responsive
                                table#demo-foo-addrow.table.m-t-10.highlight.contact-list(data-page-size='10')
                                    thead
                                        tr
                                            th No
                                            th Name
                                            th Email
                                            th 15Days pay
                                            th 30Days pay
                                            th Pay Count
                                            th Pay Cost
                                            th Res_day
                                            th Action
                                            th Block
                                    tbody
                                        - var count = 1;
                                        each user in users
                                            tr
                                                td #{count}
                                                td
                                                    .chip
                                                        if user.photoUrl
                                                            img(src='/images/'+user.photoUrl alt='Contact Person')
                                                        else
                                                            img(src='/images/login.jpg' alt='Contact Person') 
                                                        |  #{user.name}
                                                td  #{user.email}
                                                td 
                                                    if user.days_15
                                                        | #{user.days_15}
                                                td
                                                    if user.days_30
                                                        | #{user.days_30}
                                                td
                                                    if user.pay_count
                                                        | #{user.pay_count}
                                                td
                                                    if user.pay_cost
                                                        |    #{user.pay_cost/100} &euro;
                                                td 
                                                    if user.res_day
                                                      |  #{user.res_day}
                                                td  
                                                    if user.state == 1
                                                        button.btn.btn-small.delete-row-btn&attributes({'user_id' : user._id})(type='button')
                                                            i.ti-close(aria-hidden='true')
                                                    else
                                                        button.btn.default.recover-row-btn&attributes({'user_id' : user._id})(type='button')
                                                            |  Unlock the account
                                                td 
                                                    if user.img_state == 0
                                                        button.btn.btn-small.btn.green.unblock-row-btn&attributes({'user_id' : user._id})(type='button')
                                                            |   Unblock
                                                    else
                                                        button.btn.btn-small.btn.red.block-row-btn&attributes({'user_id' : user._id})(type='button')
                                                            |   Block

                                            - count++;
                                    tfoot
                                        tr
                                            td(colspan='8')
                                                //- a.waves-effect.waves-light.btn.modal-trigger(href='#add-contact') Add New Contact
                                                //- #add-contact.modal
                                                //-     .modal-content
                                                //-         from
                                                //-             .row
                                                //-                 .input-field.col.s12
                                                //-                     input#name(type='text')
                                                //-                     label(for='name') Name
                                                //-             .row
                                                //-                 .input-field.col.s12
                                                //-                     input#email(type='email')
                                                //-                     label(for='email') Email
                                                //-             .row
                                                //-                 .input-field.col.s12
                                                //-                     input#phone(type='text')
                                                //-                     label(for='phone') Phone
                                                //-             .row
                                                //-                 .input-field.col.s12
                                                //-                     input#designation(type='text')
                                                //-                     label(for='designation') Designation
                                                //-             .row
                                                //-                 .input-field.col.s12
                                                //-                     input#age(type='text')
                                                //-                     label(for='age') Age
                                                //-             .row
                                                //-                 .input-field.col.s12
                                                //-                     input#date.datepicker(type='text')
                                                //-                     label(for='date') Date
                                                //-             .row
                                                //-                 .input-field.col.s12
                                                //-                     input#salary(type='text')
                                                //-                     label(for='salary') Salary
                                                //-             .row
                                                //-                 .file-field.input-field.col.s12
                                                //-                     .btn
                                                //-                         span File
                                                //-                         input(type='file')
                                                //-                     .file-path-wrapper
                                                //-                         input.file-path.validate(type='text')
                                                //-     .modal-footer
                                                //-         a.btn.modal-action.modal-close.waves-effect.waves-light.cyan(href='#!') Save
                                                //-         a.btn.modal-action.modal-close.waves-effect.waves-light.grey.darken-4(href='#!') Cancel
                                            td(colspan='3')
                                                .text-right
                                                    ul.pagination  

block pageCss
    link(href='/assets/libs/footable/css/footable.core.css' rel='stylesheet')
    link(href='/dist/css/pages/footable-page.css' rel='stylesheet')

block pageJavascript
    script(src='/assets/libs/footable/dist/footable.all.min.js')
    script.
        $(window).on('load', function() {

            // Add & Remove Row
            var addrow = $('#demo-foo-addrow');
            addrow.footable().on('click', '.delete-row-btn', function() {

                //get the footable object
                var footable = addrow.data('footable');

                //get the row we are wanting to delete
                var row = $(this).parents('tr:first');

                var userid = $(this).attr('user_id');
                alert("I agree to block this user.");

                //delete the row
                $.ajax({
                    url: "/admin/user/delete",
                    type: "POST",
                    dataType: "json",
                    data: {
                        userId : userid
                    },
                    success: function(result) {
                        //- footable.removeRow(row); 
                        location.reload();
                    },
                    error: function() {                      
                        location.reload();
                    },
                });
            });

            //- recover user
            addrow.footable().on('click', '.recover-row-btn', function() {

                //get the footable object
                var footable = addrow.data('footable');

                //get the row we are wanting to delete
                var row = $(this).parents('tr:first');

                var userid = $(this).attr('user_id');
                alert("I agree to recover this user.");

                //delete the row
                $.ajax({
                    url: "/admin/user/recover",
                    type: "POST",
                    dataType: "json",
                    data: {
                        userId : userid
                    },
                    success: function(result) {
                        //- footable.removeRow(row); 
                        location.reload();
                    },
                    error: function() {                      
                        location.reload();
                    },
                });
            });

            // blocking user
            addrow.footable().on('click', '.block-row-btn', function() {

                //get the footable object
                var footable = addrow.data('footable');

                //get the row we are wanting to delete
                var row = $(this).parents('tr:first');

                var userid = $(this).attr('user_id');
                alert("I confirm to block this user.");

                //delete the row
                $.ajax({
                    url: "/admin/user/block",
                    type: "POST",
                    dataType: "json",
                    data: {
                        userId : userid
                    },
                    success: function(result) {
                        //- footable.removeRow(row); 
                        location.reload();
                    },
                    error: function() {                      
                        location.reload();
                    },
                });
            });
            // unblocking user
            addrow.footable().on('click', '.unblock-row-btn', function() {

                //get the footable object
                var footable = addrow.data('footable');

                //get the row we are wanting to delete
                var row = $(this).parents('tr:first');

                var userid = $(this).attr('user_id');
                alert("I confirm to unblock this user.");

                //delete the row
                $.ajax({
                    url: "/admin/user/unblock",
                    type: "POST",
                    dataType: "json",
                    data: {
                        userId : userid
                    },
                    success: function(result) {
                        //- footable.removeRow(row); 
                        location.reload();
                    },
                    error: function() {                      
                        location.reload();
                    },
                });
            });
            
        });


